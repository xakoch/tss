document.addEventListener("DOMContentLoaded",function(){("undefined"!=typeof barba?initPageTransitions:(console.warn("Barba.js не найден"),initScript))()});let lenis;function initLenis(){try{var e;"undefined"==typeof Lenis?console.warn("Lenis не найден"):(lenis&&lenis.destroy(),lenis=new Lenis({duration:1.2,easing:e=>Math.min(1,1.001-Math.pow(2,-10*e)),direction:"vertical",gestureDirection:"vertical",smooth:!0,mouseMultiplier:1,smoothTouch:!1,touchMultiplier:2,infinite:!1}),requestAnimationFrame(function e(t){lenis.raf(t),requestAnimationFrame(e)}),0<(e=document.querySelectorAll('a[href^="#"]:not([href="#"])')).length&&e.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();e=this.getAttribute("href"),e=document.querySelector(e);e&&lenis.scrollTo(e,{offset:0,duration:1.2,easing:e=>Math.min(1,1.001-Math.pow(2,-10*e))})})}),console.log("Lenis initialized successfully"))}catch(e){console.error("Error in initLenis:",e)}}function initPageTransitions(){try{barba.hooks.before(()=>{window.scrollTo({top:0})}),barba.init({sync:!1,debug:!1,timeout:7e3,transitions:[{name:"default",once({next:e}){updateBodyClass(e.html),initScript(),"undefined"!=typeof gsap&&gsap.from(e.container,{opacity:0,duration:.5,ease:"power1.out",clearProps:"all"})},async leave(e){try{if(e&&e.current&&e.current.container){if(initBarbaNavUpdate(e),"undefined"!=typeof gsap)return gsap.to(e.current.container,{opacity:0,duration:.5,ease:"power1.out",onComplete:()=>{e.current.container.remove()}});e.current.container.style.opacity="0",await delay(500),e.current.container.remove()}}catch(e){console.error("Error in leave transition:",e)}},async enter({next:t}){try{var e,n,o;if(updateBodyClass(t.html),t.container.style.opacity="0","undefined"!=typeof gsap)return(e=gsap.timeline()).to(t.container,{opacity:1,duration:.5,ease:"power1.out",clearProps:"opacity"}),n=t.container.querySelector(".header"),o=t.container.querySelector(".hero__title h1"),n&&e.to(n,{opacity:1,y:0,duration:.8,ease:"power2.out"},"-=0.3"),o&&e.to(o,{opacity:1,y:0,duration:.8,ease:"power2.out"},"-=0.5"),e;t.container.style.opacity="1"}catch(e){console.error("Error in enter transition:",e),t.container.style.opacity="1"}},async beforeEnter({next:e}){var t;updateBodyClass(e.html),"undefined"!=typeof gsap&&(t=e.container.querySelector(".header"),e=e.container.querySelector(".hero__title h1"),t&&gsap.set(t,{opacity:0,y:-30}),e)&&gsap.set(e,{opacity:0,y:50}),initScript()}}]})}catch(e){console.error("Error in initPageTransitions:",e),initScript()}}function updateBodyClass(e){try{var t;e&&(t=e.match(/<body.+?class="([^"]*)"/i),document.body.setAttribute("class",t?t[1]:""))}catch(e){console.error("Error in updateBodyClass:",e)}}function delay(t=2e3){return new Promise(e=>setTimeout(e,t))}function initScript(){try{initLenis(),initBarbaNavUpdate(),initWindowInnerheight(),initSwiperSlider(),animateCommonElements(),isHomePage()&&initHomePage(),initCalc()}catch(e){console.error("Error in initScript:",e)}}function animateCommonElements(){try{if("undefined"==typeof gsap)console.warn("GSAP не найден, анимации элементов недоступны");else{var e=document.querySelector(".header"),t=(e&&gsap.fromTo(e,{opacity:0,y:-30},{opacity:1,y:0,duration:.8,ease:"power2.out"}),document.querySelector(".hero__title h1"));t&&gsap.fromTo(t,{opacity:0,y:50},{opacity:1,y:0,duration:.8,delay:.2,ease:"power2.out"});const n=document.querySelector(".footer");if(n){gsap.set(n,{opacity:0,y:80});const o=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&!n.classList.contains("animated")&&(gsap.to(n,{opacity:1,y:0,duration:.8,ease:"power2.out"}),n.classList.add("animated"),o.unobserve(n))})},{threshold:.1,rootMargin:"0px 0px -10% 0px"});o.observe(n)}}}catch(e){console.error("Error in animateCommonElements:",e)}}function isHomePage(){try{var e;return document.body.classList.contains("home")||document.body.classList.contains("homepage")||document.body.classList.contains("home-page")?!0:!("/"!==(e=window.location.pathname)&&"/index.html"!==e&&"/index.php"!==e&&!e.endsWith("/")&&""!==e&&!document.querySelector(".slider-block")&&!document.querySelector(".custom-count-number"))}catch(e){return console.error("Error in isHomePage:",e),!1}}function initBarbaNavUpdate(e){try{if(e&&e.next&&e.next.html){const t=$(e.next.html).find("[data-barba-update]");0<t.length&&$("[data-barba-update]").each(function(e){0<$(t[e]).length&&(e=$(t[e]).attr("data-link-status"),$(this).attr("data-link-status",e))})}}catch(e){console.error("Error in initBarbaNavUpdate:",e)}}function initWindowInnerheight(){try{$(document).ready(()=>{var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",e+"px")})}catch(e){console.error("Error in initWindowInnerheight:",e)}}function initSwiperSlider(){try{"undefined"==typeof Swiper?console.warn("Swiper не найден"):(document.querySelector(".typecard__slide")&&new Swiper(".typecard__slide",{slidesPerView:1,loop:!0,speed:800,navigation:{nextEl:".btn-next",prevEl:".btn-prev"},autoplay:{delay:2500,disableOnInteraction:!0}}),document.querySelector(".blog-slider")&&new Swiper(".blog-slider",{slidesPerView:2,loop:!0,spaceBetween:20,navigation:{nextEl:".btn-next",prevEl:".btn-prev"},breakpoints:{1200:{slidesPerView:3}},autoplay:{delay:2500,disableOnInteraction:!0}}),initVideoCarousel())}catch(e){console.error("Error in initSwiperSlider:",e)}}function initVideoCarousel(){try{var e;function o(){document.querySelectorAll(".review-video").forEach(e=>{e.pause(),e.currentTime=0})}"undefined"==typeof jQuery?console.warn("jQuery не найден, Slick карусель недоступна"):0===(e=jQuery(".reviews__slider")).length||e.hasClass("slick-initialized")||(e.slick({dots:!0,infinite:!0,slidesToShow:1,slidesToScroll:1,centerMode:!0,centerPadding:"0px",speed:500,variableWidth:!0,cssEase:"ease-in-out",lazyLoad:"ondemand",responsive:[{breakpoint:1024,settings:{slidesToShow:2,slidesToScroll:1}},{breakpoint:600,settings:{slidesToShow:1,slidesToScroll:1}}]}),e.on("beforeChange",()=>{o()}),document.querySelectorAll(".play-button").forEach(n=>{n.addEventListener("click",e=>{var t=n.closest(".slide");t.classList.contains("slick-active")?(t=t.querySelector(".review-video"))&&(o(),t.play().then(()=>{n.style.display="none"}).catch(e=>console.error("Ошибка воспроизведения:",e))):(e.preventDefault(),e.stopPropagation())})}),document.querySelectorAll(".review-video").forEach(e=>{const t=e.closest(".slide").querySelector(".play-button");e.addEventListener("click",()=>{e.closest(".slide").classList.contains("slick-active")&&(e.paused?(o(),e.play().then(()=>{t.style.display="none"}).catch(e=>console.error("Ошибка воспроизведения:",e))):e.pause())}),e.addEventListener("pause",()=>{t.style.display="block"}),e.addEventListener("play",()=>{t.style.display="none"})}),console.log("Video carousel initialized successfully"))}catch(e){console.error("Error in initVideoCarousel:",e)}}function initHomePage(){try{var e=document.querySelectorAll(".slider-block"),t=(0<e.length&&e.forEach(a=>{try{const c=a.querySelector(".slider-track"),l=a.querySelectorAll(".slider-slide");if(!c||0===l.length)return void console.warn("Missing slider elements in block",a);let o=a.querySelector(".slider-control"),t=(o?o.innerHTML="":((o=document.createElement("div")).classList.add("slider-control"),a.prepend(o)),0),n=0,r=0,i=!1,e;const d=n=>{n>=l.length?n=0:n<0&&(n=l.length-1);var e=l[0].offsetWidth;"undefined"!=typeof gsap?gsap.to(c,{x:-n*e,duration:.6,ease:"power2.out"}):c.style.transform=`translateX(-${n*e}px)`,a.querySelectorAll(".slider-button").forEach((e,t)=>{e.classList.toggle("active",t===n)}),t=n},u=()=>{p(),e=setInterval(()=>{d(t+1)},3500)},p=()=>{e&&(clearInterval(e),e=null)};l.forEach((e,t)=>{var n=document.createElement("button");n.classList.add("slider-button"),n.textContent=t+1,n.addEventListener("click",()=>{d(t),u()}),o.appendChild(n)});var s=o.querySelector(".slider-button");s&&s.classList.add("active"),c.addEventListener("touchstart",e=>{n=e.touches[0].clientX,i=!0,p()}),c.addEventListener("touchmove",e=>{i&&(r=e.touches[0].clientX)}),c.addEventListener("touchend",()=>{var e;i&&(e=n-r,50<Math.abs(e)&&(0<e&&t<l.length-1?d(t+1):e<0&&0<t&&d(t-1)),i=!1,u())}),a.addEventListener("mouseenter",p),a.addEventListener("mouseleave",u),window.addEventListener("resize",()=>{d(t)}),u()}catch(e){console.error("Error in slider block processing:",e)}}),document.querySelectorAll(".custom-count-number"));if(0<t.length&&"undefined"!=typeof gsap){const n=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting&&!e.target.dataset.animated)try{var t=(s=(s=e.target.textContent)&&s.trim().match(/^([\d,]+)(\s*[<%]?)$/))?{number:parseInt(s[1].replace(/,/g,""),10),suffix:s[2]||""}:null;if(t){var{number:n,suffix:o}=t;e.target.dataset.animated="true";{var r=e.target,i=n,a=o;const c={value:0};r.style.opacity="1",gsap.to(c,{value:i,duration:2,ease:"power1.out",onUpdate:function(){r.textContent=""+Math.floor(c.value).toLocaleString("en-US")+a}})}}}catch(e){console.error("Error in number animation:",e)}var s})},{threshold:.1,rootMargin:"0px 0px -25% 0px"});t.forEach(e=>{n.observe(e)})}const o=document.querySelectorAll(".typecard__tab"),r=document.querySelectorAll(".typecard__content");0<o.length&&0<r.length&&o.forEach(e=>{e.addEventListener("click",function(){try{o.forEach(e=>e.classList.remove("typecard__tab_active")),this.classList.add("typecard__tab_active");var e=this.getAttribute("data-tab");if(e){const t=document.querySelector(".typecard__content_active"),n=document.getElementById(e+"-content");n&&t&&("undefined"!=typeof gsap?gsap.to(t,{opacity:0,duration:.3,onComplete:function(){t.classList.remove("typecard__content_active"),n.classList.add("typecard__content_active"),n.style.opacity=0,gsap.to(n,{opacity:1,duration:.3})}}):"undefined"!=typeof jQuery?jQuery(".typecard__content_active").fadeOut(300,function(){jQuery(this).removeClass("typecard__content_active"),jQuery(n).css("display","none").addClass("typecard__content_active").fadeIn(300)}):(r.forEach(e=>e.classList.remove("typecard__content_active")),n.classList.add("typecard__content_active")))}}catch(e){console.error("Error in tab click handling:",e)}})})}catch(e){console.error("Error in initHomePage:",e)}}function initCalc(){try{const i=document.getElementById("fleet-slider"),a=document.getElementById("fleet-value"),s=document.getElementById("fleet-tooltip"),c=document.getElementById("gallons-slider"),l=document.getElementById("gallons-value"),d=document.getElementById("gallons-tooltip"),u=document.getElementById("savings-amount"),p=document.querySelectorAll(".button-group__button");if(i&&c&&u){let n=1,o=1,r=50;function t(){var e=.5*r*n*o,e=Number.isInteger(e)?e:e.toFixed(1);if("undefined"!=typeof gsap&&u){const t={value:parseFloat(u.textContent)||0};gsap.to(t,{value:parseFloat(e),duration:.5,ease:"power1.out",onUpdate:function(){var e=Number.isInteger(t.value)?Math.floor(t.value):t.value.toFixed(1);u.textContent=""+e}})}else u.textContent=""+e}function e(e,t){var n,o;e&&t&&(n=parseInt(e.min),o=parseInt(e.max),o=(parseInt(e.value)-n)/(o-n)*100/100*(e.offsetWidth-60)+30,"undefined"!=typeof gsap?gsap.to(t,{left:o+"px",duration:.2,ease:"power1.out"}):t.style.left=o+"px")}i&&a&&s&&i.addEventListener("input",function(){n=parseInt(this.value),a.textContent=n,s.textContent=n,e(i,s),t()}),c&&l&&d&&c.addEventListener("input",function(){r=parseInt(this.value),l.textContent=r,d.textContent=r,e(c,d),t()}),0<p.length&&p.forEach(e=>{e.addEventListener("click",function(){p.forEach(e=>e.classList.remove("button-group__button--active")),this.classList.add("button-group__button--active"),o=parseInt(this.dataset.value)||1,t()})}),window.addEventListener("load",function(){e(i,s),e(c,d)}),t()}}catch(e){console.error("Error in initCalc:",e)}}